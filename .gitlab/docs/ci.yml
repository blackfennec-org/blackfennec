variables:
  DOCS_BUILD_IMAGE: sphinxdoc/sphinx

###############################################################################
# Build Latest Documentation
###############################################################################

build latest code docs:
  image: $DOCS_BUILD_IMAGE
  stage: prebuild
  script:
    - sphinx-apidoc -f -o docs/source/software_documentation/code/ .
  artifacts:
    paths:
      - docs/source/software_documentation/code
  only:
    - tags

build latest html:
  image: $DOCS_BUILD_IMAGE
  stage: build
  before_script:
    - pip install -r docs/requirements.txt
  script:
    - cd docs
    - make html
  artifacts:
    paths:
      - docs/_build/html
  only:
    - tags

###############################################################################
# Publish Gitlab Pages
###############################################################################

pages:
  image: $DOCS_BUILD_IMAGE
  stage: deploy
  script:
    - cd docs
    - mv _build/html/ ../public
  artifacts:
    paths:
      - public
  only:
    - tags
